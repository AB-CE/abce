{% extends "layout.html" %}
{% block body %}
  <div class="mdl-cell mdl-cell--6-col" id="setup">
    <div class="mdl-card mdl-card--expand mdl-shadow--4dp">
      <div class="mdl-card__supporting-text">
          {{ setup | safe }}
      </div>
    </div>
  </div>
  <div class="mdl-cell mdl-cell--6-col" id="description" style="height: 200px;">
    <div class="mdl-card mdl-card--expand mdl-card--limited_height mdl-shadow--4dp">
      <div class="mdl-card__actions mdl-card--border">
        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"
           onclick="raise_description()">
          Expand Description
        </a>
      </div>
      <div class="mdl-card__supporting-text">
        <pre>{{ desc |safe}}</pre>
      </div>
    </div>
  </div>
  <div id="begin">
  </div>
  {% for entry in entries %}
  <div class="mdl-cell mdl-cell--4-col" id="{{ entry['title']|safe }}">
    <div class="mdl-card mdl-card--expand mdl-shadow--4dp">
      <div class="mdl-card__actions mdl-card--title" style="display: none;"  id="{{ entry['title']|safe }}title" onclick="minimize('{{ entry['title']|safe }}', '{{ entry['idname']|safe }}', '{{ entry['title']|safe }}title')">>
          {{ entry['title'] | safe }}
      </div>
      <div class="mdl-card__actions mdl-card--border">
        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"
           onclick="minimize('{{ entry['title']|safe }}', '{{ entry['idname']|safe }}', '{{ entry['title']|safe }}title')">
          Min
        </a>
        <a class="mdl-button mdl-button--colored mdl-js-button mdl-js-ripple-effect"
           onclick="raise_window('{{ entry['title']|safe }}', '{{ entry['idname']|safe }}')">
          Zoom
        </a>
      </div>
      <div class="mdl-card__supporting-text">
          {{ entry['graph'] | safe }}
      </div>
    </div>
  </div>
  {% else %}
    <em>Unbelievable.  No entries here so far</em>
  {% endfor %}
  <div id="before_end">
  </div>
  <div id="end">
  </div>

<script type="text/javascript">
function raise_window(idname, id_graph) {
       var xDiv = document.getElementById(idname);
       var currentClass = xDiv.className;
       if (currentClass == "mdl-cell mdl-cell--4-col") {
          xDiv.className = "mdl-cell mdl-cell--12-col";
       } else {
          xDiv.className = "mdl-cell mdl-cell--4-col";
       }
       var plot = Bokeh.index[id_graph];
       plot.resize_width_height(true, false, false);
       window.location.hash = idname;
}
function raise_description() {
       var xDiv = document.getElementById('description');

       if (xDiv.style.height != '') {
           xDiv.style.height = '';}
       else {
           xDiv.style.height = '200px';}
       window.location.hash = 'description';
}
function minimize(id_box, id_graph, id_title) {
       var xDiv = document.getElementById(id_box);
       var end = document.getElementById("end");
       var before_end = document.getElementById("before_end");

       if (xDiv.style.width == '') {
           xDiv.style.width = '150px';
           xDiv.style.height = '50px';
           xDiv.style.overflow = 'hidden';

           var title = document.getElementById(id_title);
           title.style.display="inline";

           end.parentNode.insertBefore(xDiv, end);
           document.cookie = id_box + "," + id_graph + "+" + id_title + "=minimize; Expires=Wed, 09 Jun 2037 10:18:14 GMT";}
       else {
           xDiv.style.width = '';
           xDiv.style.height = '';

           var title = document.getElementById(id_title);
           title.style.display="none";

           end.parentNode.insertBefore(xDiv, before_end);
           document.cookie = id_box + "," + id_graph + "+" + id_title +  + "=full";}
       window.location.hash = id_box;}

window.onload = function getCookie() {
    var keyValuePairs = document.cookie.split(/; */);
    for(var i = 0; i < keyValuePairs.length; i++) {
        var id_box = keyValuePairs[i].substring(0, keyValuePairs[i].indexOf(','));
        var id_graph = keyValuePairs[i].substring(keyValuePairs[i].indexOf(',') + 1, keyValuePairs[i].indexOf('+'));
        var id_title = keyValuePairs[i].substring(keyValuePairs[i].indexOf('+') + 1, keyValuePairs[i].indexOf('='));
        var value = keyValuePairs[i].substring(keyValuePairs[i].indexOf('=') + 1);
        if (value == "minimize") {
              minimize(id_box, id_graph, id_title);}}}

function change_text_field(x, text_field_name) {
    document.getElementById(text_field_name).value = x;}

function change_slider_field(x, slider_field_name) {
    document.getElementById(slider_field_name).MaterialSlider.change(x);}

</script>

{% endblock %}
