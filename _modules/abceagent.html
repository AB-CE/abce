

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>abceagent &mdash; ABCE 0.2alpha documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.2alpha',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="ABCE 0.2alpha documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ABCE 0.2alpha documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for abceagent</h1><div class="highlight"><pre>
<span class="c"># Copyright 2012 Davoud Taghawi-Nejad</span>
<span class="c">#</span>
<span class="c"># Module Author: Davoud Taghawi-Nejad</span>
<span class="c">#</span>
<span class="c"># ABCE is open-source software. If you are using ABCE for your research you are</span>
<span class="c"># requested the quote the use of this software.</span>
<span class="c">#</span>
<span class="c"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not</span>
<span class="c"># use this file except in compliance with the License and quotation of the</span>
<span class="c"># author. You may obtain a copy of the License at</span>
<span class="c">#       http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="c"># Unless required by applicable law or agreed to in writing, software</span>
<span class="c"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT</span>
<span class="c"># WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the</span>
<span class="c"># License for the specific language governing permissions and limitations under</span>
<span class="c"># the License.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">The :class:`abceagent.Agent` class is the basic class for creating your agent. It automatically handles the</span>
<span class="sd">possession of goods of an agent. In order to produce/transforme goods you need to also subclass</span>
<span class="sd">the :class:`abceagent.Firm` [1]_ or to create a consumer the :class:`abceagent.Household`.</span>

<span class="sd">For detailed documentation on:</span>

<span class="sd">Trading:</span>
<span class="sd">    see :class:`abceagent.Trade`</span>
<span class="sd">Logging and data creation:</span>
<span class="sd">    see :class:`abceagent.Database` and :doc:`simulation_results`</span>
<span class="sd">Messaging between agents:</span>
<span class="sd">    see :class:`abceagent.Messaging`.</span>

<span class="sd">.. autoexception:: abcetools.NotEnoughGoods</span>

<span class="sd">.. [1] or :class:`abceagent.FirmMultiTechnologies` for simulations with complex technologies.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">zmq</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span>
<span class="kn">import</span> <span class="nn">compiler</span>
<span class="kn">import</span> <span class="nn">pyparsing</span> <span class="kn">as</span> <span class="nn">pp</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span><span class="p">,</span> <span class="n">defaultdict</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">optimize</span>
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">isnan</span>
<span class="kn">from</span> <span class="nn">abcetools</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getmembers</span><span class="p">,</span> <span class="n">ismethod</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">shuffle</span>
<span class="n">save_err</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">seterr</span><span class="p">(</span><span class="n">invalid</span><span class="o">=</span><span class="s">&#39;ignore&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Messaging"><a class="viewcode-back" href="../Messaging.html#abceagent.Messaging">[docs]</a><span class="k">class</span> <span class="nc">Messaging</span><span class="p">:</span>
    <span class="c">#TODO public way of sending messages and objects</span>
<div class="viewcode-block" id="Messaging.message"><a class="viewcode-back" href="../Messaging.html#abceagent.Messaging.message">[docs]</a>    <span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sends a message to agent, agent_group or &#39;all&#39;. Agents receive it</span>
<span class="sd">        at the beginning of next round with :meth:`~abceagent.Messaging.get_messages` or</span>
<span class="sd">        :meth:`~abceagent.Messaging.get_messages_all`.</span>

<span class="sd">        Args::</span>

<span class="sd">         receiver_group: agent, agent_group or &#39;all&#39;</span>
<span class="sd">         topic: string, with which this message can be received</span>
<span class="sd">         content: string, dictionary or class, that is send.</span>

<span class="sd">        Example::</span>

<span class="sd">            ... household_01 ...</span>
<span class="sd">            self.message(&#39;firm_01&#39;, &#39;quote_sell&#39;, {&#39;good&#39;:&#39;BRD&#39;, &#39;quantity&#39;: 5})</span>

<span class="sd">            ... firm_01 - one subround later ...</span>
<span class="sd">            requests = self.get_messages(&#39;quote_sell&#39;)</span>
<span class="sd">            for req in requests:</span>
<span class="sd">                self.sell(req.sender, req.good, reg.quantity, self.price[req.good])</span>

<span class="sd">        Example2::</span>

<span class="sd">         self.message(&#39;firm_01&#39;, &#39;m&#39;, &quot;hello my message&quot;)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">message</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">content</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Messaging.get_messages"><a class="viewcode-back" href="../Messaging.html#abceagent.Messaging.get_messages">[docs]</a>    <span class="k">def</span> <span class="nf">get_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all new messages send with :meth:`~abceagent.Messaging.message`</span>
<span class="sd">        (topic=&#39;m&#39;). The order is randomized. self.messages(topic) returns all</span>
<span class="sd">        messages with a topic.</span>

<span class="sd">        A message is a string with the message. You can also retrieve the sender</span>
<span class="sd">        by `message.sender_group` and `message.sender_idn` and view the topic with</span>
<span class="sd">        &#39;message.topic&#39;. (see example)</span>

<span class="sd">        If you are sending a float or an integer you need to access the message</span>
<span class="sd">        content with `message.content` instead of only `message`.</span>

<span class="sd">        Example::</span>

<span class="sd">         ... agent_01 ...</span>
<span class="sd">         self.messages(&#39;firm_01&#39;, &#39;potential_buyers&#39;, &#39;hello message&#39;)</span>

<span class="sd">         ... firm_01 - one subround later ...</span>
<span class="sd">         potential_buyers = get_messages(&#39;potential_buyers&#39;)</span>
<span class="sd">         for msg in potential_buyers:</span>
<span class="sd">            print(&#39;message: &#39;, msg)</span>
<span class="sd">            print(&#39;message: &#39;, msg.content)</span>
<span class="sd">            print(&#39;group name: &#39;, msg.sender_group)</span>
<span class="sd">            print(&#39;sender id: &#39;, msg.sender_idn)</span>
<span class="sd">            print(&#39;topic: &#39;, msg.topic)</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="n">topic</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="n">topic</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Messaging.get_messages_all"><a class="viewcode-back" href="../Messaging.html#abceagent.Messaging.get_messages_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_messages_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all messages irregardless of the topic, in a dictionary by topic</span>

<span class="sd">        A message is a string with the message. You can also retrieve the sender</span>
<span class="sd">        by `message.sender_group` and `message.sender_idn` and view the topic with</span>
<span class="sd">        &#39;message.topic&#39;. (see example)</span>

<span class="sd">        If you are sending a float or an integer you need to access the message</span>
<span class="sd">        content with `message.content` instead of only `message`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Messaging.get_messages_biased"><a class="viewcode-back" href="../Messaging.html#abceagent.Messaging.get_messages_biased">[docs]</a>    <span class="k">def</span> <span class="nf">get_messages_biased</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic</span><span class="o">=</span><span class="s">&#39;m&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; like self.messages(topic), but the order is not properly randomized, but</span>
<span class="sd">        its faster. use whenever you are sure that the way you process messages</span>
<span class="sd">        is not affected by the order</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">topic</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>

</div></div>
<span class="k">def</span> <span class="nf">message</span><span class="p">(</span><span class="n">sender_group</span><span class="p">,</span> <span class="n">sender_idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">topic</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
    <span class="n">msg</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;sender_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender_group</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;sender_idn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender_idn</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver_group</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver_idn</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;topic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">topic</span>
    <span class="n">msg</span><span class="p">[</span><span class="s">&#39;content&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">content</span>
    <span class="k">return</span> <span class="n">msg</span>


<span class="k">class</span> <span class="nc">Message</span><span class="p">():</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__get__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">content</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>


<div class="viewcode-block" id="Trade"><a class="viewcode-back" href="../Trade.html#abceagent.Trade">[docs]</a><span class="k">class</span> <span class="nc">Trade</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; Agents can trade with each other. The clearing of the trade is taken care</span>
<span class="sd">    of fully by ABCE.</span>
<span class="sd">    Selling a good works in the following way:</span>

<span class="sd">    1. An agent sends an offer. :meth:`~abceagent.Trade.sell`</span>

<span class="sd">       *The good offered is blocked and self.possession(...) does not account for it.*</span>

<span class="sd">    2. **Next subround:** An agent receives the offer :meth:`~abceagent.Trade.get_offers`, and can</span>
<span class="sd">       :meth:`~abceagent.Trade.accept`, :meth:`~abceagent.Trade.reject` or partially accept it. :meth:`~abceagent.Trade.accept_partial`</span>

<span class="sd">       *The good is credited and the price is deducted from the agent&#39;s possesions.*</span>

<span class="sd">    3. **Next subround:**</span>

<span class="sd">       - in case of acceptal *the money is automatically credited.*</span>
<span class="sd">       - in case of partial acceptance *the money is credited and part of the blocked good is unblocked.*</span>
<span class="sd">       - in case of rejection *the good is unblocked.*</span>

<span class="sd">    Analogously for buying. (:meth:`~buy`)</span>

<span class="sd">    Example::</span>

<span class="sd">        # Agent 1</span>
<span class="sd">        def sales(self):</span>
<span class="sd">            self.remember_trade = self.sell(&#39;Household&#39;, 0, &#39;cookies&#39;, quantity=5, price=self.price)</span>

<span class="sd">        # Agent 2</span>
<span class="sd">        def receive_sale(self):</span>
<span class="sd">            oo = self.get_offers(&#39;cookies&#39;)</span>
<span class="sd">            for offer in oo:</span>
<span class="sd">                if offer[&#39;price&#39;] &lt; 0.3:</span>
<span class="sd">                    try:</span>
<span class="sd">                        self.accept(offer)</span>
<span class="sd">                    except NotEnoughGoods:</span>
<span class="sd">                        self.accept_partial(offer, self.possession(&#39;money&#39;) / offer[&#39;price&#39;])</span>
<span class="sd">                else:</span>
<span class="sd">                    self.reject(offer)</span>

<span class="sd">        # Agent 1, subround 3</span>
<span class="sd">        def learning(self):</span>
<span class="sd">            offer = self.info(self.remember_trade)</span>
<span class="sd">            if offer[&#39;status&#39;] == &#39;reject&#39;:</span>
<span class="sd">                self.price *= .9</span>
<span class="sd">            elif offer[&#39;status&#39;] = &#39;partial&#39;:</span>
<span class="sd">                self.price *= offer[&#39;final_quantity&#39;] / offer[&#39;quantity&#39;]</span>

<span class="sd">    Quotes on the other hand allow you to ask a trade partner to send you a not committed price quote.</span>
<span class="sd">    The modeller has to implement a response mechanism. For convenience :meth:`~abceagent.Trade.accept_quote` and</span>
<span class="sd">    :meth:`~abceagent.Trade.accept_quote_partial`, send a committed offer that its the uncommitted price quote.</span>


<span class="sd">    &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Trade.get_quotes"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.get_quotes">[docs]</a>    <span class="k">def</span> <span class="nf">get_quotes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; self.quotes() returns all new quotes and removes them. The order</span>
<span class="sd">        is randomized.</span>

<span class="sd">        Example::</span>

<span class="sd">         quotes = self.get_quotes()</span>

<span class="sd">        Returns::</span>
<span class="sd">         list of quotes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;q&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">[</span><span class="s">&#39;q&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Trade.get_quotes_biased"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.get_quotes_biased">[docs]</a>    <span class="k">def</span> <span class="nf">get_quotes_biased</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; like self.quotes(), but the order is not randomized, so</span>
<span class="sd">        its faster.</span>

<span class="sd">        self.quotes() returns all new quotes and removes them. The order</span>
<span class="sd">        is randomized.</span>

<span class="sd">        Use whenever you are sure that the way you process messages</span>
<span class="sd">        is not affected by the order.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;q&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;q&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>
</div>
<div class="viewcode-block" id="Trade.info"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_idn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; lets you access all fields of a **given** offer.</span>
<span class="sd">        This allows you to check whether an offer was accepted, partially accepted</span>
<span class="sd">        or rejected and retrieve the quantity actually traded.</span>

<span class="sd">        If in your first round the value your are testing is not set, set the variable</span>
<span class="sd">        to `None`. None in the first round returns an empty trade with quantity = 0 and price = 1.</span>
<span class="sd">        The status in accepted.</span>

<span class="sd">        Example::</span>

<span class="sd">            class Example:</span>
<span class="sd">                def __init__(self):</span>
<span class="sd">                    self.last_offer = None</span>
<span class="sd">                    self.price = 5</span>

<span class="sd">                def selling(self):</span>
<span class="sd">                    if self.info(self.last_offer)[&#39;status&#39;] == &#39;accept&#39;:</span>
<span class="sd">                        self.price += 1</span>
<span class="sd">                    self.last_offer = self.sell(&#39;Household&#39;, 1, &#39;cookies&#39;, 5, self.price)</span>

<span class="sd">        Returns a dictionary; Fields:</span>
<span class="sd">            [&#39;status&#39;]:</span>
<span class="sd">                &#39;accepted&#39;:</span>
<span class="sd">                    trade fully accepted</span>
<span class="sd">                &#39;partial&#39;:</span>
<span class="sd">                    [&#39;final_quantity&#39;] and self.offer_partial_status_percentage(...)</span>
<span class="sd">                    for the quantities actually accepted</span>
<span class="sd">                &#39;rejected&#39;:</span>
<span class="sd">                    trade rejected</span>
<span class="sd">                &#39;perished&#39;:</span>
<span class="sd">                    the **perishable** good was not accepted by the end of the round</span>
<span class="sd">                    and therefore perished.</span>
<span class="sd">            [&#39;quantity&#39;]:</span>
<span class="sd">                the quantity of the original quote.</span>
<span class="sd">            [&#39;final_quantity&#39;]:</span>
<span class="sd">                This returns the accutal quantity bought or sold. (Equal to quantity</span>
<span class="sd">                    if the offer was accepted fully)</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError:</span>
<span class="sd">                If the offer was answered more than one round ago.</span>
<span class="sd">            KeyError - Dictionary:</span>
<span class="sd">                The dictionary has no status and raises a KeyError, iff the offer</span>
<span class="sd">                was not yet answered.</span>
<span class="sd">                see `Example Pending` below.</span>


<span class="sd">        Example Pending::</span>

<span class="sd">            try:</span>
<span class="sd">                status = info(self.offer_idn)[&#39;status&#39;]</span>
<span class="sd">            except KeyError:</span>
<span class="sd">                print(&#39;offer has not yet been answered&#39;)</span>

<span class="sd">        Example::</span>

<span class="sd">            from pybrain.rl.learners.valuebased import ActionValueTable</span>
<span class="sd">            from pybrain.rl.agents import LearningAgent</span>
<span class="sd">            from pybrain.rl.learners import Q</span>

<span class="sd">            def __init__(self):</span>
<span class="sd">                controller = ActionValueTable(dimState=1, numActions=1)</span>
<span class="sd">                learner = Q()</span>
<span class="sd">                rl_price = LearningAgent(controller, learner)</span>
<span class="sd">                self.car_cost = 500</span>

<span class="sd">            def sales(self):</span>
<span class="sd">                price = reinforcement_learner.getAction():</span>
<span class="sd">                self.offer = self.sell(&#39;Household&#39;, 1, &#39;car&#39;, 1, price)</span>

<span class="sd">            def learn(self):</span>
<span class="sd">                reinforcement_learner.integrateObservation([offer_status(self.offer)])</span>
<span class="sd">                reinforcement_learner.giveReward([offer_status(self.offer) * price - self.car_cost])</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;accepted&#39;</span><span class="p">:</span>
            <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="k">elif</span>  <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rejected&#39;</span><span class="p">:</span>
            <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">offer</span>
</div>
<div class="viewcode-block" id="Trade.partial_status_percentage"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.partial_status_percentage">[docs]</a>    <span class="k">def</span> <span class="nf">partial_status_percentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_idn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns the percentage of a partial accept</span>

<span class="sd">        Args:</span>
<span class="sd">            offer_idn:</span>
<span class="sd">                on offer as returned by self.sell(...) ord self.buy(...)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A value between [0, 1]</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError, when no answer has not been given or received more than one round before</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span> <span class="o">/</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;quantity&#39;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;accepted&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">1</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;rejected&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="mi">0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span>

</div>
<div class="viewcode-block" id="Trade.accept_quote"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.accept_quote">[docs]</a>    <span class="k">def</span> <span class="nf">accept_quote</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quote</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; makes a commited buy or sell out of the counterparties quote</span>

<span class="sd">        Args::</span>
<span class="sd">         quote: buy or sell quote that is accepted</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;qs&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="n">quote</span><span class="p">[</span><span class="s">&#39;sender&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="n">quote</span><span class="p">[</span><span class="s">&#39;sender&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Trade.accept_quote_partial"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.accept_quote_partial">[docs]</a>    <span class="k">def</span> <span class="nf">accept_quote_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">quote</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; makes a commited buy or sell out of the counterparties quote</span>

<span class="sd">        Args::</span>
<span class="sd">         quote: buy or sell quote that is accepted</span>
<span class="sd">         quantity: the quantity that is offered/requested</span>
<span class="sd">         it should be less than propsed in the quote, but this is not enforced.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;qs&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">buy</span><span class="p">(</span><span class="n">quote</span><span class="p">[</span><span class="s">&#39;sender&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sell</span><span class="p">(</span><span class="n">quote</span><span class="p">[</span><span class="s">&#39;sender&#39;</span><span class="p">],</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">quote</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])</span>

    <span class="c">#TODO create assert unanswered offers</span>
</div>
<div class="viewcode-block" id="Trade.get_offers_all"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.get_offers_all">[docs]</a>    <span class="k">def</span> <span class="nf">get_offers_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all offers in a dictionary, with goods as key. The in each</span>
<span class="sd">        goods-category the goods are ordert by price. The order can be reverse</span>
<span class="sd">        by setting descending=True</span>

<span class="sd">        *Offers that are not accepted in the same subround (def block) are</span>
<span class="sd">        automatically rejected.* However you can also manualy reject.</span>

<span class="sd">        Args::</span>

<span class="sd">         descending(optional): is a bool. False for descending True for</span>
<span class="sd">                               ascending by price</span>

<span class="sd">        Example2::</span>

<span class="sd">         oo = get_offers_all(descending=False)</span>
<span class="sd">         for good_category in oo:</span>
<span class="sd">            print(&#39;The cheapest good of category&#39; + good_category</span>
<span class="sd">            + &#39; is &#39; + good_category[0])</span>
<span class="sd">         #sorted list of beer prices and seller</span>
<span class="sd">         for offer in oo[&#39;beer&#39;]:</span>
<span class="sd">            print(offer[&#39;price&#39;], offer[&#39;sender&#39;])</span>

<span class="sd">        Lists can only efficiently pop the last item. Therefore it is more</span>
<span class="sd">        efficient to order backward and buy the last good first::</span>

<span class="sd">         def buy_input_good(self):</span>
<span class="sd">            offers = self.get_offers_all(descending=True)</span>
<span class="sd">            while offers:</span>
<span class="sd">                if offers[good][-1][&#39;quantity&#39;] == self.prices_for_which_buy[good]:</span>
<span class="sd">                    self.accept(offers[good].pop())</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offers_by_good</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">offer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;polled&#39;</span>
            <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span>
            <span class="n">offers_by_good</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offer</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">offers_by_good</span><span class="p">:</span>
            <span class="n">shuffle</span><span class="p">(</span><span class="n">offers_by_good</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
            <span class="n">offers_by_good</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">objects</span><span class="p">:</span> <span class="n">objects</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">descending</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offers_by_good</span>
</div>
<div class="viewcode-block" id="Trade.get_offers"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.get_offers">[docs]</a>    <span class="k">def</span> <span class="nf">get_offers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">descending</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all offers of the &#39;good&#39; ordered by price.</span>

<span class="sd">        *Offers that are not accepted in the same subround (def block) are</span>
<span class="sd">        automatically rejected.* However you can also manualy reject.</span>

<span class="sd">        Args::</span>

<span class="sd">         good: the good which should be retrieved</span>
<span class="sd">         descending(=False): is a bool. False for descending True for</span>
<span class="sd">                             ascending by price</span>

<span class="sd">        Example::</span>

<span class="sd">            offers = get_offers(&#39;books&#39;)</span>
<span class="sd">            for offer in offers:</span>
<span class="sd">                if offer[&#39;price&#39;] &lt; 50:</span>
<span class="sd">                    self.accept(offer)</span>
<span class="sd">                elif offer[&#39;price&#39;] &lt; 100:</span>
<span class="sd">                    self.accept_partial(offer, 1)</span>
<span class="sd">                else:</span>
<span class="sd">                    self.reject(offer)  # optional</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">offer_idn</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;good&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">good</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;polled&#39;</span>
                <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">])</span>
        <span class="n">shuffle</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
        <span class="n">ret</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">objects</span><span class="p">:</span> <span class="n">objects</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">descending</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="Trade.quote_sell"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.quote_sell">[docs]</a>    <span class="k">def</span> <span class="nf">quote_sell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; quotes a price to sell quantity of &#39;good&#39; to a receiver</span>

<span class="sd">        price (money) per unit</span>
<span class="sd">        offers a deal without checking or committing resources</span>

<span class="sd">        Args:</span>
<span class="sd">            receiver_group:</span>
<span class="sd">                agent group name of the agent</span>
<span class="sd">            receiver_idn:</span>
<span class="sd">                the agent&#39;s id number</span>
<span class="sd">            &#39;good&#39;:</span>
<span class="sd">                name of the good</span>
<span class="sd">            quantity:</span>
<span class="sd">                maximum units disposed to sell at this price</span>
<span class="sd">            price:</span>
<span class="sd">                price per unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">Offer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="s">&#39;qs&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offer</span>
</div>
<div class="viewcode-block" id="Trade.quote_buy"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.quote_buy">[docs]</a>    <span class="k">def</span> <span class="nf">quote_buy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; quotes a price to buy quantity of &#39;good&#39; a receiver</span>

<span class="sd">        price (money) per unit</span>
<span class="sd">        offers a deal without checking or committing resources</span>

<span class="sd">        Args:</span>
<span class="sd">            receiver_group:</span>
<span class="sd">                agent group name of the agent</span>
<span class="sd">            receiver_idn:</span>
<span class="sd">                the agent&#39;s id number</span>
<span class="sd">            &#39;good&#39;:</span>
<span class="sd">                name of the good</span>
<span class="sd">            quantity:</span>
<span class="sd">                maximum units disposed to buy at this price</span>
<span class="sd">            price:</span>
<span class="sd">                price per unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">Offer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="s">&#39;qb&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="s">&#39;q&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">offer</span>
</div>
<div class="viewcode-block" id="Trade.sell"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.sell">[docs]</a>    <span class="k">def</span> <span class="nf">sell</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; commits to sell the quantity of good at price</span>

<span class="sd">        The goods are not in haves or self.count(). When the offer is</span>
<span class="sd">        rejected they are automatically reacreditated. When the offer is</span>
<span class="sd">        accepted the money amount is accreditated. (partial acceptance</span>
<span class="sd">        accordingly)</span>

<span class="sd">        Args:</span>
<span class="sd">            receiver_group: an agent name  NEVER a group or &#39;all&#39;!!!</span>
<span class="sd">            (its an error but with a confusing warning)</span>
<span class="sd">            &#39;good&#39;: name of the good</span>
<span class="sd">            quantity: maximum units disposed to buy at this price</span>
<span class="sd">            price: price per unit</span>

<span class="sd">        Returns:</span>
<span class="sd">            A reference to the offer. The offer and the offer status can</span>
<span class="sd">            be accessed with `self.info(offer_reference)`.</span>

<span class="sd">        Example::</span>

<span class="sd">            def subround_1(self):</span>
<span class="sd">                self.offer = self.sell(&#39;household&#39;, 1, &#39;cookies&#39;, quantity=5, price=0.1)</span>

<span class="sd">            def subround_2(self):</span>
<span class="sd">                offer = self.info(self.offer)</span>
<span class="sd">                if offer[&#39;status&#39;] == &#39;partial&#39;:</span>
<span class="sd">                    print(offer[&#39;final_quantity&#39;] , &#39;cookies have be bougth&#39;)</span>
<span class="sd">                elif:</span>
<span class="sd">                    offer[&#39;status&#39;] == &#39;accepted&#39;:</span>
<span class="sd">                    print(&#39;Cookie monster bougth them all&#39;)</span>
<span class="sd">                elif:</span>
<span class="sd">                    offer[&#39;status&#39;] == &#39;rejected&#39;:</span>
<span class="sd">                    print(&#39;On diet&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">price</span> <span class="o">&gt;=</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">price</span>
        <span class="k">assert</span> <span class="n">quantity</span> <span class="o">&gt;</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">,</span> <span class="n">quantity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quantity</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-=</span> <span class="n">quantity</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">Offer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">buysell</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">idn</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_offer_counter</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="s">&#39;_o&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">offer</span>
        <span class="k">return</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Trade.buy"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.buy">[docs]</a>    <span class="k">def</span> <span class="nf">buy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; commits to sell the quantity of good at price</span>

<span class="sd">        The goods are not in haves or self.count(). When the offer is</span>
<span class="sd">        rejected they are automatically reacreditated. When the offer is</span>
<span class="sd">        accepted the money amount is accreditated. (partial acceptance</span>
<span class="sd">        accordingly)</span>

<span class="sd">        Args:</span>
<span class="sd">            receiver_group: an agent name  NEVER a group or &#39;all&#39;!!!</span>
<span class="sd">            (its an error but with a confusing warning)</span>
<span class="sd">            &#39;good&#39;: name of the good</span>
<span class="sd">            quantity: maximum units disposed to buy at this price</span>
<span class="sd">            price: price per unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">money_amount</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">price</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;money&#39;</span><span class="p">,</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">money_amount</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="n">Offer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="s">&#39;b&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_offer_counter</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="s">&#39;_o&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">offer</span>
        <span class="k">return</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Trade.retract"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.retract">[docs]</a>    <span class="k">def</span> <span class="nf">retract</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_idn</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The agent who made a buy or sell offer can retract it</span>

<span class="sd">        The offer an agent made is deleted at the end of the subround and the</span>
<span class="sd">        committeg good reapears in the haves. However if another agent</span>
<span class="sd">        accepts in the same round the trade will be cleared and not retracted.</span>

<span class="sd">        Args:</span>
<span class="sd">            offer: the offer he made with buy or sell</span>
<span class="sd">            (offer not quote!)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">][</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="s">&#39;_d&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_idn</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Trade.accept"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.accept">[docs]</a>    <span class="k">def</span> <span class="nf">accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The offer is accepted and cleared</span>

<span class="sd">        Args::</span>

<span class="sd">            offer: the offer the other party made</span>
<span class="sd">            (offer not quote!)</span>

<span class="sd">        Return:</span>
<span class="sd">            Returns a dictionary with the good&#39;s quantity and the amount paid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">money_amount</span> <span class="o">=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;money&#39;</span><span class="p">,</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_idn&#39;</span><span class="p">],</span> <span class="s">&#39;_a&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]:</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> <span class="s">&#39;money&#39;</span><span class="p">:</span> <span class="n">money_amount</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="Trade.accept_partial"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.accept_partial">[docs]</a>    <span class="k">def</span> <span class="nf">accept_partial</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; TODO The offer is partly accepted and cleared</span>

<span class="sd">        Args:</span>
<span class="sd">            offer: the offer the other party made</span>
<span class="sd">            (offer not quote!)</span>

<span class="sd">        Return:</span>
<span class="sd">            Returns a dictionary with the good&#39;s quantity and the amount paid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span><span class="p">(</span><span class="n">is_negative</span><span class="p">(</span><span class="n">quantity</span><span class="p">)),</span> <span class="n">quantity</span>
        <span class="k">assert</span> <span class="n">quantity</span> <span class="o">&lt;=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">],</span> <span class="s">&#39;accepted more than offered </span><span class="si">%s</span><span class="s">: </span><span class="si">%f</span><span class="s"> &gt; </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">])</span>
        <span class="n">money_amount</span> <span class="o">=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">&#39;money&#39;</span><span class="p">,</span> <span class="n">money_amount</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">quantity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">-=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">&lt;</span> <span class="n">quantity</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">quantity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">quantity</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_idn&#39;</span><span class="p">],</span> <span class="s">&#39;_p&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">)</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]:</span> <span class="n">quantity</span><span class="p">,</span> <span class="s">&#39;money&#39;</span><span class="p">:</span> <span class="n">money_amount</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="Trade.reject"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.reject">[docs]</a>    <span class="k">def</span> <span class="nf">reject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; The offer is rejected</span>

<span class="sd">        Args:</span>
<span class="sd">            offer: the offer the other party made</span>
<span class="sd">            (offer not quote!)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_idn&#39;</span><span class="p">],</span> <span class="s">&#39;_r&#39;</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">])</span>
        <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span>
</div>
    <span class="k">def</span> <span class="nf">_receive_accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; When the other party accepted the  money or good is received</span>
<span class="sd">        and the offer deleted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;accepted&quot;</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer</span>
        <span class="k">return</span> <span class="n">offer</span>

    <span class="k">def</span> <span class="nf">_log_receive_accept_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_log_receive_accept_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]),</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">agent_name</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_receive_partial_accept</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; When the other party partially accepted the  money or good is</span>
<span class="sd">        received, remaining good or money is added back to haves and the offer</span>
<span class="sd">        is deleted</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">])</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;partial&quot;</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">offer</span>
        <span class="k">return</span> <span class="n">offer</span>

    <span class="k">def</span> <span class="nf">_log_receive_partial_accept_group</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_log_receive_partial_accept_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">agent_name</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]),</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%s</span><span class="s">,</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">],</span> <span class="n">agent_name</span><span class="p">(</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">],</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">])]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;final_quantity&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_receive_reject</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; delets a given offer</span>

<span class="sd">        is used by _msg_clearing__end_of_subround, when the other party rejects</span>
<span class="sd">        or at the end of the subround when agent retracted the offer</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&quot;rejected&quot;</span>
        <span class="n">offer</span><span class="p">[</span><span class="s">&#39;status_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer</span>

    <span class="k">def</span> <span class="nf">_delete_given_offer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">offer_id</span><span class="p">):</span>
        <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">offer_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span>

<div class="viewcode-block" id="Trade.give"><a class="viewcode-back" href="../Trade.html#abceagent.Trade.give">[docs]</a>    <span class="k">def</span> <span class="nf">give</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gives a good to another agent</span>

<span class="sd">        Args:</span>

<span class="sd">            receiver_group:</span>
<span class="sd">                Group name of the receiver</span>
<span class="sd">            receiver_idn:</span>
<span class="sd">                id number of the receiver</span>
<span class="sd">            good:</span>
<span class="sd">                the good to be transfered</span>
<span class="sd">            quantity:</span>
<span class="sd">                amount to be transfered</span>

<span class="sd">        Raises:</span>

<span class="sd">            AssertionError, when good smaller than 0.</span>

<span class="sd">        Return:</span>
<span class="sd">            Dictionary, with the transfere, which can be used by self.log(...).</span>

<span class="sd">        Example::</span>

<span class="sd">            self.log(&#39;taxes&#39;, self.give(&#39;money&#39;: 0.05 * self.possession(&#39;money&#39;))</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="n">quantity</span> <span class="o">&gt;=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">quantity</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-=</span> <span class="n">quantity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_send</span><span class="p">(</span><span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="s">&#39;_g&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">])</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">good</span><span class="p">:</span> <span class="n">quantity</span><span class="p">}</span>

    <span class="c">#TODO take</span>

</div></div>
<div class="viewcode-block" id="FirmMultiTechnologies"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies">[docs]</a><span class="k">class</span> <span class="nc">FirmMultiTechnologies</span><span class="p">:</span>
<div class="viewcode-block" id="FirmMultiTechnologies.produce_use_everything"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.produce_use_everything">[docs]</a>    <span class="k">def</span> <span class="nf">produce_use_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Produces output goods from all input goods, used in this</span>
<span class="sd">        production_function, the agent owns.</span>

<span class="sd">        Args::</span>

<span class="sd">            production_function: A production_function produced with</span>
<span class="sd">            py:meth:`~abceagent.FirmMultiTechnologies.create_production_function`, py:meth:`~abceagent.FirmMultiTechnologies.create_cobb_douglas` or</span>
<span class="sd">            py:meth:`~abceagent.FirmMultiTechnologies.create_leontief`</span>

<span class="sd">        Example::</span>

<span class="sd">            self.produce_use_everything(car_production_function)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">produce</span><span class="p">(</span><span class="n">production_function</span><span class="p">,</span> <span class="nb">dict</span><span class="p">((</span><span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">possession</span><span class="p">(</span><span class="n">inp</span><span class="p">))</span> <span class="k">for</span> <span class="n">inp</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="FirmMultiTechnologies.produce"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.produce">[docs]</a>    <span class="k">def</span> <span class="nf">produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Produces output goods given the specified amount of inputs.</span>

<span class="sd">        Transforms the Agent&#39;s goods specified in input goods</span>
<span class="sd">        according to a given production_function to output goods.</span>
<span class="sd">        Automatically changes the agent&#39;s belonging. Raises an</span>
<span class="sd">        exception, when the agent does not have sufficient resources.</span>

<span class="sd">        Args:</span>
<span class="sd">            production_function:</span>
<span class="sd">                A production_function produced with py:meth:`~abceagent.FirmMultiTechnologies..create_production_function`,</span>
<span class="sd">                py:meth:`~abceagent.FirmMultiTechnologies..create_cobb_douglas` or py:meth:`~abceagent.FirmMultiTechnologies..create_leontief`</span>
<span class="sd">            input goods {dictionary}:</span>
<span class="sd">                dictionary containing the amount of input good used for the production.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotEnoughGoods: This is raised when the goods are insufficient.</span>

<span class="sd">        Example::</span>

<span class="sd">            car = {&#39;tire&#39;: 4, &#39;metal&#39;: 2000, &#39;plastic&#39;:  40}</span>
<span class="sd">            bike = {&#39;tire&#39;: 2, &#39;metal&#39;: 400, &#39;plastic&#39;:  20}</span>
<span class="sd">            try:</span>
<span class="sd">                self.produce(car_production_function, car)</span>
<span class="sd">            except NotEnoughGoods:</span>
<span class="sd">                A.produce(bike_production_function, bike)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="p">(</span><span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]))</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-=</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="n">goods_vector</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">good</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">])</span>
        <span class="n">goods_vector</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">input_goods</span><span class="p">)</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="p">{},</span> <span class="n">goods_vector</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">+=</span> <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">([(</span><span class="n">good</span><span class="p">,</span> <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">])</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]])</span>
</div>
<div class="viewcode-block" id="FirmMultiTechnologies.create_production_function"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.create_production_function">[docs]</a>    <span class="k">def</span> <span class="nf">create_production_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a production function from formula</span>

<span class="sd">        A production function is a produceation process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        goods.</span>
<span class="sd">        Production_functions are than used as an argument in produce,</span>
<span class="sd">        predict_vector_produce and predict_output_produce.</span>

<span class="sd">        create_production_function_fast is faster but more complicated</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            production process. (string) Several equation are seperated by a ;</span>

<span class="sd">        Returns:</span>
<span class="sd">            A production_function that can be used in produce etc.</span>

<span class="sd">        Example:</span>
<span class="sd">            formula = &#39;golf_ball = (ball) * (paint / 2); waste = 0.1 * paint&#39;</span>
<span class="sd">            self.production_function = self.create_production_function(formula)</span>
<span class="sd">            self.produce(self.production_function, {&#39;ball&#39; : 1, &#39;paint&#39; : 2}</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parse_single_output</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphas</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span><span class="o">+</span><span class="s">&quot;_&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span> <span class="o">+</span> <span class="s">&#39;*/+-().[]{} &#39;</span><span class="p">))</span>
        <span class="n">parse_output</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">delimitedList</span><span class="p">(</span><span class="n">parse_single_output</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">)</span>
        <span class="n">parse_single_input</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span> \
                <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">OneOrMore</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">nums</span> <span class="o">+</span> <span class="s">&#39;*/+-().[]{} &#39;</span><span class="p">)))</span> <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">))</span>
        <span class="n">parse_input</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">delimitedList</span><span class="p">(</span><span class="n">parse_single_input</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">)</span>

        <span class="n">production_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_output</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">formula</span><span class="p">))</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_input</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">formula</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">production_function</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.create_production_function_fast"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.create_production_function_fast">[docs]</a>    <span class="k">def</span> <span class="nf">create_production_function_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">output_goods</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a production function from formula, with given outputs</span>

<span class="sd">        A production function is a producetion process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        goods.</span>
<span class="sd">        Production_functions are than used as an argument in produce,</span>
<span class="sd">        predict_vector_produce and predict_output_produce.</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            production process. (string) Several equation are seperated by a ;</span>
<span class="sd">            [output]: list of all output goods (left hand sides of the equations)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A production_function that can be used in produce etc.</span>

<span class="sd">        Example:</span>
<span class="sd">            formula = &#39;golf_ball = (ball) * (paint / 2); waste = 0.1 * paint&#39;</span>
<span class="sd">            self.production_function = self.create_production_function(formula, &#39;golf&#39;, [&#39;waste&#39;, &#39;paint&#39;])</span>
<span class="sd">            self.produce(self.production_function, {&#39;ball&#39; : 1, &#39;paint&#39; : 2}</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">production_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">output_goods</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_goods</span>
        <span class="k">return</span> <span class="n">production_function</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.create_cobb_douglas"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.create_cobb_douglas">[docs]</a>    <span class="k">def</span> <span class="nf">create_cobb_douglas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">exponents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a Cobb-Douglas production function</span>

<span class="sd">        A production function is a produceation process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        good.</span>
<span class="sd">        Production_functions are than used as an argument in produce,</span>
<span class="sd">        predict_vector_produce and predict_output_produce.</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;output&#39;: Name of the output good</span>
<span class="sd">            multiplier: Cobb-Douglas multiplier</span>
<span class="sd">            {&#39;input1&#39;: exponent1, &#39;input2&#39;: exponent2 ...}: dictionary</span>
<span class="sd">            containing good names &#39;input&#39; and correstponding exponents</span>
<span class="sd">        Returns:</span>
<span class="sd">            A production_function that can be used in produce etc.</span>

<span class="sd">        Example:</span>
<span class="sd">        self.plastic_production_function = self.create_cobb_douglas(&#39;plastic&#39;, {&#39;oil&#39; : 10, &#39;labor&#39; : 1}, 0.000001)</span>
<span class="sd">        self.produce(self.plastic_production_function, {&#39;oil&#39; : 20, &#39;labor&#39; : 1})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ordered_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_good</span> <span class="k">for</span> <span class="n">input_good</span> <span class="ow">in</span> <span class="n">exponents</span><span class="p">]</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39;=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;*&#39;</span> <span class="o">+</span> <span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;(</span><span class="si">%s</span><span class="s">)**</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input_good</span><span class="p">,</span> <span class="n">exponent</span><span class="p">)</span> <span class="k">for</span> <span class="n">input_good</span><span class="p">,</span> <span class="n">exponent</span> <span class="ow">in</span> <span class="n">exponents</span><span class="o">.</span><span class="n">iteritems</span><span class="p">())</span>
        <span class="n">optimization</span> <span class="o">=</span> <span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;(</span><span class="si">%s</span><span class="s">)**</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">exponents</span><span class="p">[</span><span class="n">good</span><span class="p">])</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">ordered_input</span><span class="p">])</span>
        <span class="n">production_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cobb-douglas&#39;</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exponents</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;multiplier&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">multiplier</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="p">]</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_input</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;optimization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimization</span>
        <span class="k">return</span> <span class="n">production_function</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.create_leontief"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.create_leontief">[docs]</a>    <span class="k">def</span> <span class="nf">create_leontief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">utilization_quantities</span><span class="p">,</span> <span class="n">isinteger</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a Leontief production function</span>


<span class="sd">        A production function is a produceation process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        good.</span>
<span class="sd">        Production_functions are than used as an argument in produce,</span>
<span class="sd">        predict_vector_produce and predict_output_produce.</span>

<span class="sd">        Warning, when you produce with a Leontief production_function all goods you</span>
<span class="sd">        put in the produce(...) function are used up. Regardless whether it is an</span>
<span class="sd">        efficient or wastefull bundle</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;output&#39;:</span>
<span class="sd">                Name of the output good</span>
<span class="sd">            utilization_quantities:</span>
<span class="sd">                a dictionary containing good names and correstponding exponents</span>
<span class="sd">            isinteger=&#39;int&#39; or isinteger=&#39;&#39;:</span>
<span class="sd">                When &#39;int&#39; produce only integer amounts of the good.</span>
<span class="sd">                When &#39;&#39;, produces floating amounts. (default)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A production_function that can be used in produce etc.</span>

<span class="sd">        Example:</span>
<span class="sd">        self.car_technology = self.create_leontief(&#39;car&#39;, {&#39;tire&#39; : 4, &#39;metal&#39; : 1000, &#39;plastic&#39; : 20}, 1)</span>
<span class="sd">        two_cars = {&#39;tire&#39;: 8, &#39;metal&#39;: 2000, &#39;plastic&#39;:  40}</span>
<span class="sd">        self.produce(self.car_technology, two_cars)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">uqi</span> <span class="o">=</span> <span class="n">utilization_quantities</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
        <span class="n">ordered_input</span> <span class="o">=</span> <span class="p">[</span><span class="n">input_good</span> <span class="k">for</span> <span class="n">input_good</span> <span class="ow">in</span> <span class="n">utilization_quantities</span><span class="p">]</span>
        <span class="n">coefficients</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">input_good</span><span class="p">,</span> <span class="n">input_quantity</span><span class="p">)</span> <span class="k">for</span> <span class="n">input_good</span><span class="p">,</span> <span class="n">input_quantity</span> <span class="ow">in</span> <span class="n">uqi</span><span class="p">)</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="n">output</span> <span class="o">+</span> <span class="s">&#39; = &#39;</span> <span class="o">+</span> <span class="n">isinteger</span> <span class="o">+</span> <span class="s">&#39;(min([&#39;</span> <span class="o">+</span> <span class="n">coefficients</span> <span class="o">+</span> <span class="s">&#39;]))&#39;</span>
        <span class="n">opt_coefficients</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">,</span> <span class="n">utilization_quantities</span><span class="p">[</span><span class="n">good</span><span class="p">])</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">ordered_input</span><span class="p">)</span>
        <span class="n">optimization</span> <span class="o">=</span> <span class="n">isinteger</span> <span class="o">+</span> <span class="s">&#39;(min([&#39;</span> <span class="o">+</span> <span class="n">opt_coefficients</span> <span class="o">+</span> <span class="s">&#39;]))&#39;</span>
        <span class="n">production_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;leontief&#39;</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">utilization_quantities</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;isinteger&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">isinteger</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">output</span><span class="p">]</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ordered_input</span>
        <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;optimization&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">optimization</span>
        <span class="k">return</span> <span class="n">production_function</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.predict_produce_output"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.predict_produce_output">[docs]</a>    <span class="k">def</span> <span class="nf">predict_produce_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Predicts the output of a certain input vector and for a given</span>
<span class="sd">            production function</span>

<span class="sd">            Predicts the production of produce(production_function, input_goods)</span>
<span class="sd">            see also: Predict_produce(.) as it returns a calculatable vector</span>

<span class="sd">        Args::</span>

<span class="sd">            production_function: A production_function produced with</span>
<span class="sd">            create_production_function, create_cobb_douglas or create_leontief</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}: dictionary</span>
<span class="sd">            containing the amount of input good used for the production.</span>

<span class="sd">        Returns::</span>

<span class="sd">            A dictionary of the predicted output</span>


<span class="sd">        Example::</span>

<span class="sd">            print(A.predict_output_produce(car_production_function, two_cars))</span>
<span class="sd">            &gt;&gt;&gt; {&#39;car&#39;: 2}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">goods_vector</span> <span class="o">=</span> <span class="n">input_goods</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]:</span>
            <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="p">{},</span> <span class="n">goods_vector</span><span class="p">)</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]:</span>
            <span class="n">output</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">output</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.predict_produce"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.predict_produce">[docs]</a>    <span class="k">def</span> <span class="nf">predict_produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a vector with input (negative) and output (positive) goods</span>

<span class="sd">            Predicts the production of produce(production_function, input_goods) and</span>
<span class="sd">            the use of input goods.</span>
<span class="sd">            net_value(.) uses a price_vector (dictionary) to calculate the</span>
<span class="sd">            net value of this production.</span>

<span class="sd">        Args:</span>
<span class="sd">            production_function: A production_function produced with</span>
<span class="sd">            create_production_function, create_cobb_douglas or create_leontief</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}: dictionary</span>
<span class="sd">            containing the amount of input good used for the production.</span>

<span class="sd">        Example::</span>

<span class="sd">         prices = {&#39;car&#39;: 50000, &#39;tire&#39;: 100, &#39;metal&#39;: 10, &#39;plastic&#39;:  0.5}</span>
<span class="sd">         value_one_car = net_value(predict_produce(car_production_function, one_car), prices)</span>
<span class="sd">         value_two_cars = net_value(predict_produce(car_production_function, two_cars), prices)</span>
<span class="sd">         if value_one_car &gt; value_two_cars:</span>
<span class="sd">            A.produce(car_production_function, one_car)</span>
<span class="sd">         else:</span>
<span class="sd">            A.produce(car_production_function, two_cars)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">goods_vector</span> <span class="o">=</span> <span class="n">input_goods</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]:</span>
            <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">exec</span><span class="p">(</span><span class="n">production_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="p">{},</span> <span class="n">goods_vector</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">goods</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;output&#39;</span><span class="p">]:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">goods</span> <span class="ow">in</span> <span class="n">production_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]:</span>
            <span class="n">result</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">goods_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="FirmMultiTechnologies.net_value"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.net_value">[docs]</a>    <span class="k">def</span> <span class="nf">net_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goods_vector</span><span class="p">,</span> <span class="n">price_vector</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates the net_value of a goods_vector given a price_vector</span>

<span class="sd">            goods_vectors are vector, where the input goods are negative and</span>
<span class="sd">            the output goods are positive. When we multiply every good with its</span>
<span class="sd">            according price we can calculate the net_value of the correstponding</span>
<span class="sd">            production.</span>
<span class="sd">            goods_vectors are produced by predict_produce(.)</span>


<span class="sd">        Args:</span>
<span class="sd">            goods_vector: a dictionary with goods and quantities</span>
<span class="sd">            e.G. {&#39;car&#39;: 1, &#39;metal&#39;: -1200, &#39;tire&#39;: -4, &#39;plastic&#39;: -21}</span>
<span class="sd">            price_vector: a dictionary with goods and prices (see example)</span>

<span class="sd">        Example::</span>

<span class="sd">         prices = {&#39;car&#39;: 50000, &#39;tire&#39;: 100, &#39;metal&#39;: 10, &#39;plastic&#39;:  0.5}</span>
<span class="sd">         value_one_car = net_value(predict_produce(car_production_function, one_car), prices)</span>
<span class="sd">         value_two_cars = net_value(predict_produce(car_production_function, two_cars), prices)</span>
<span class="sd">         if value_one_car &gt; value_two_cars:</span>
<span class="sd">            produce(car_production_function, one_car)</span>
<span class="sd">         else:</span>
<span class="sd">            produce(car_production_function, two_cars)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span> <span class="ow">in</span> <span class="n">goods_vector</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">ret</span> <span class="o">+=</span> <span class="n">price_vector</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">*</span> <span class="n">quantity</span>
        <span class="k">return</span> <span class="n">ret</span>
</div>
<div class="viewcode-block" id="FirmMultiTechnologies.sufficient_goods"><a class="viewcode-back" href="../FirmMultiTechnologies.html#abceagent.FirmMultiTechnologies.sufficient_goods">[docs]</a>    <span class="k">def</span> <span class="nf">sufficient_goods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; checks whether the agent has all the goods in the vector input &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">input_goods</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span>

</div></div>
<div class="viewcode-block" id="Firm"><a class="viewcode-back" href="../Firm.html#abceagent.Firm">[docs]</a><span class="k">class</span> <span class="nc">Firm</span><span class="p">(</span><span class="n">FirmMultiTechnologies</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The firm class allows you to declare a production function for a firm.</span>
<span class="sd">    :meth:`~Firm.set_leontief`, :meth:`~abecagent.Firm.set_production_function`</span>
<span class="sd">    :meth:`~Firm.set_cobb_douglas`,</span>
<span class="sd">    :meth:`~Firm.set_production_function_fast`</span>
<span class="sd">    (FirmMultiTechnologies, allows you to declare several) With :meth:`~Firm.produce`</span>
<span class="sd">    and :meth:`~Firm.produce_use_everything` you can produce using the</span>
<span class="sd">    according production function. You have several auxiliarifunctions</span>
<span class="sd">    for example to predict the production. When you multiply</span>
<span class="sd">    :meth:`~Firm.predict_produce` with the price vector you get the</span>
<span class="sd">    profitability of the prodiction.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c">#TODO Example</span>
<div class="viewcode-block" id="Firm.produce_use_everything"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.produce_use_everything">[docs]</a>    <span class="k">def</span> <span class="nf">produce_use_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Produces output goods from all input goods.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.produce_use_everything()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">produce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">possessions_all</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="Firm.produce"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.produce">[docs]</a>    <span class="k">def</span> <span class="nf">produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Produces output goods given the specified amount of inputs.</span>

<span class="sd">        Transforms the Agent&#39;s goods specified in input goods</span>
<span class="sd">        according to a given production_function to output goods.</span>
<span class="sd">        Automatically changes the agent&#39;s belonging. Raises an</span>
<span class="sd">        exception, when the agent does not have sufficient resources.</span>

<span class="sd">        Args:</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}:</span>
<span class="sd">                dictionary containing the amount of input good used for the production.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotEnoughGoods:</span>
<span class="sd">                This is raised when the goods are insufficient.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.set_cobb_douglas_production_function(&#39;car&#39; ..)</span>
<span class="sd">            car = {&#39;tire&#39;: 4, &#39;metal&#39;: 2000, &#39;plastic&#39;:  40}</span>
<span class="sd">            try:</span>
<span class="sd">                self.produce(car)</span>
<span class="sd">            except NotEnoughGoods:</span>
<span class="sd">                print(&#39;today no cars&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">FirmMultiTechnologies</span><span class="o">.</span><span class="n">produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.sufficient_goods"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.sufficient_goods">[docs]</a>    <span class="k">def</span> <span class="nf">sufficient_goods</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; checks whether the agent has all the goods in the vector input &quot;&quot;&quot;</span>
        <span class="n">FirmMultiTechnologies</span><span class="o">.</span><span class="n">sufficient_goods</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.set_production_function"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.set_production_function">[docs]</a>    <span class="k">def</span> <span class="nf">set_production_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  sets the firm to use a Cobb-Douglas production function from a</span>
<span class="sd">        formula.</span>

<span class="sd">        A production function is a produceation process that produces the given</span>
<span class="sd">        input given input goods according to the formula to the output goods.</span>
<span class="sd">        Production_functions are than used to produce, predict_vector_produce and</span>
<span class="sd">        predict_output_produce.</span>

<span class="sd">        create_production_function_fast is faster but more complicated</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            production process. (string) Several equation are seperated by a ;</span>

<span class="sd">        Example::</span>

<span class="sd">            formula = &#39;golf_ball = (ball) * (paint / 2); waste = 0.1 * paint&#39;</span>
<span class="sd">            self.set_production_function(formula)</span>
<span class="sd">            self.produce({&#39;ball&#39; : 1, &#39;paint&#39; : 2}</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_production_function</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.set_production_function_fast"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.set_production_function_fast">[docs]</a>    <span class="k">def</span> <span class="nf">set_production_function_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">output_goods</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  sets the firm to use a Cobb-Douglas production function from a</span>
<span class="sd">        formula, with given outputs</span>

<span class="sd">        A production function is a produceation process that produces the given</span>
<span class="sd">        input given input goods according to the formula to the output goods.</span>
<span class="sd">        Production_functions are than used to produce, predict_vector_produce and</span>
<span class="sd">        predict_output_produce.</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            production process. (string) Several equation are seperated by a ;</span>
<span class="sd">            [output]: list of all output goods (left hand sides of the equations)</span>

<span class="sd">        Example::</span>

<span class="sd">            formula = &#39;golf_ball = (ball) * (paint / 2); waste = 0.1 * paint&#39;</span>
<span class="sd">            self.production_function_fast(formula, &#39;golf&#39;, [&#39;waste&#39;])</span>
<span class="sd">            self.produce(self, {&#39;ball&#39; : 1, &#39;paint&#39; : 2}</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_production_function_fast</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">output_goods</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">,</span> <span class="n">typ</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.set_cobb_douglas"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.set_cobb_douglas">[docs]</a>    <span class="k">def</span> <span class="nf">set_cobb_douglas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">exponents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;  sets the firm to use a Cobb-Douglas production function.</span>

<span class="sd">        A production function is a produceation process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        good.</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;output&#39;: Name of the output good</span>
<span class="sd">            multiplier: Cobb-Douglas multiplier</span>
<span class="sd">            {&#39;input1&#39;: exponent1, &#39;input2&#39;: exponent2 ...}: dictionary</span>
<span class="sd">            containing good names &#39;input&#39; and correstponding exponents</span>

<span class="sd">        Example::</span>

<span class="sd">            self.create_cobb_douglas(&#39;plastic&#39;, 0.000001, {&#39;oil&#39; : 10, &#39;labor&#39; : 1})</span>
<span class="sd">            self.produce({&#39;oil&#39; : 20, &#39;labor&#39; : 1})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_cobb_douglas</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">exponents</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.set_leontief"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.set_leontief">[docs]</a>    <span class="k">def</span> <span class="nf">set_leontief</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">utilization_quantities</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">isinteger</span><span class="o">=</span><span class="s">&#39;int&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sets the firm to use a Leontief production function.</span>

<span class="sd">        A production function is a production process that produces the</span>
<span class="sd">        given input given input goods according to the formula to the output</span>
<span class="sd">        good.</span>

<span class="sd">        Warning, when you produce with a Leontief production_function all goods you</span>
<span class="sd">        put in the produce(...) function are used up. Regardless whether it is an</span>
<span class="sd">        efficient or wastefull bundle</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;output&#39;: Name of the output good</span>
<span class="sd">            {&#39;input1&#39;: utilization_quantity1, &#39;input2&#39;: utilization_quantity2 ...}: dictionary</span>
<span class="sd">            containing good names &#39;input&#39; and correstponding exponents</span>
<span class="sd">            multiplier: multipler</span>
<span class="sd">            isinteger=&#39;int&#39; or isinteger=&#39;&#39;: When &#39;int&#39; produce only integer</span>
<span class="sd">            amounts of the good. When &#39;&#39;, produces floating amounts.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.create_leontief(&#39;car&#39;, {&#39;tire&#39; : 4, &#39;metal&#39; : 1000, &#39;plastic&#39; : 20}, 1)</span>
<span class="sd">            two_cars = {&#39;tire&#39;: 8, &#39;metal&#39;: 2000, &#39;plastic&#39;:  40}</span>
<span class="sd">            self.produce(two_cars)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_leontief</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">utilization_quantities</span><span class="p">,</span> <span class="n">multiplier</span><span class="p">,</span> <span class="n">isinteger</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.predict_produce_output"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.predict_produce_output">[docs]</a>    <span class="k">def</span> <span class="nf">predict_produce_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Calculates the output of a production (but does not preduce)</span>

<span class="sd">            Predicts the production of produce(production_function, input_goods)</span>
<span class="sd">            see also: Predict_produce(.) as it returns a calculatable vector</span>

<span class="sd">        Args:</span>
<span class="sd">            production_function: A production_function produced with</span>
<span class="sd">            create_production_function, create_cobb_douglas or create_leontief</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}: dictionary</span>
<span class="sd">            containing the amount of input good used for the production.</span>

<span class="sd">        Example::</span>

<span class="sd">            print(A.predict_output_produce(car_production_function, two_cars))</span>
<span class="sd">            &gt;&gt;&gt; {&#39;car&#39;: 2}</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">predict_produce_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Firm.predict_produce"><a class="viewcode-back" href="../Firm.html#abceagent.Firm.predict_produce">[docs]</a>    <span class="k">def</span> <span class="nf">predict_produce</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a vector with input (negative) and output (positive) goods</span>

<span class="sd">            Predicts the production of produce(production_function, input_goods) and</span>
<span class="sd">            the use of input goods.</span>
<span class="sd">            net_value(.) uses a price_vector (dictionary) to calculate the</span>
<span class="sd">            net value of this production.</span>

<span class="sd">        Args:</span>
<span class="sd">            production_function: A production_function produced with</span>
<span class="sd">            create_production_function, create_cobb_douglas or create_leontief</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}: dictionary</span>
<span class="sd">            containing the amount of input good used for the production.</span>

<span class="sd">        Example::</span>

<span class="sd">         prices = {&#39;car&#39;: 50000, &#39;tire&#39;: 100, &#39;metal&#39;: 10, &#39;plastic&#39;:  0.5}</span>
<span class="sd">         value_one_car = net_value(predict_produce(car_production_function, one_car), prices)</span>
<span class="sd">         value_two_cars = net_value(predict_produce(car_production_function, two_cars), prices)</span>
<span class="sd">         if value_one_car &gt; value_two_cars:</span>
<span class="sd">             A.produce(car_production_function, one_car)</span>
<span class="sd">         else:</span>
<span class="sd">             A.produce(car_production_function, two_cars)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">predict_produce</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_production_function</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="Household"><a class="viewcode-back" href="../Household.html#abceagent.Household">[docs]</a><span class="k">class</span> <span class="nc">Household</span><span class="p">:</span>
<div class="viewcode-block" id="Household.utility_function"><a class="viewcode-back" href="../Household.html#abceagent.Household.utility_function">[docs]</a>    <span class="k">def</span> <span class="nf">utility_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; the utility function should be created with:</span>
<span class="sd">        set_cobb_douglas_utility_function,</span>
<span class="sd">        create_utility_function or</span>
<span class="sd">        create_utility_function_fast</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span>
</div>
<div class="viewcode-block" id="Household.consume_everything"><a class="viewcode-back" href="../Household.html#abceagent.Household.consume_everything">[docs]</a>    <span class="k">def</span> <span class="nf">consume_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; consumes everything that is in the utility function</span>
<span class="sd">        returns utility according consumption</span>

<span class="sd">        A utility_function, has to be set before see</span>
<span class="sd">        py:meth:`~abceagent.Household.set_   utility_function`,</span>
<span class="sd">        py:meth:`~abceagent.Household.set_cobb_douglas_utility_function`</span>

<span class="sd">        Returns:</span>
<span class="sd">            A the utility a number. To log it see example.</span>

<span class="sd">        Example::</span>

<span class="sd">            utility = self.consume_everything()</span>
<span class="sd">            self.log(&#39;utility&#39;: {&#39;u&#39;: utility})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">consume</span><span class="p">(</span><span class="nb">dict</span><span class="p">((</span><span class="n">inp</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">inp</span><span class="p">])</span> <span class="k">for</span> <span class="n">inp</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]))</span>
</div>
<div class="viewcode-block" id="Household.consume"><a class="viewcode-back" href="../Household.html#abceagent.Household.consume">[docs]</a>    <span class="k">def</span> <span class="nf">consume</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; consumes input_goods returns utility according to the agent&#39;s</span>
<span class="sd">        consumption function</span>

<span class="sd">        A utility_function, has to be set before see</span>
<span class="sd">        py:meth:`~abceagent.Household.set_   utility_function`,</span>
<span class="sd">        py:meth:`~abceagent.Household.set_cobb_douglas_utility_function` or</span>

<span class="sd">        Args:</span>
<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}:</span>
<span class="sd">                dictionary containing the amount of input good consumed.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NotEnoughGoods: This is raised when the goods are insufficient.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A the utility a number. To log it see example.</span>

<span class="sd">        Example::</span>

<span class="sd">            self.consumption_set = {&#39;car&#39;: 1, &#39;ball&#39;: 2000, &#39;bike&#39;:  2}</span>
<span class="sd">            self.consumption_set = {&#39;car&#39;: 0, &#39;ball&#39;: 2500, &#39;bike&#39;:  20}</span>
<span class="sd">            try:</span>
<span class="sd">                utility = self.consume(utility_function, self.consumption_set)</span>
<span class="sd">            except NotEnoughGoods:</span>
<span class="sd">                utility = self.consume(utility_function, self.smaller_consumption_set)</span>
<span class="sd">            self.log(&#39;utility&#39;: {&#39;u&#39;: utility})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">][</span><span class="n">good</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-=</span> <span class="n">input_goods</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="n">goods_vector</span> <span class="o">=</span> <span class="n">input_goods</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">goods_vector</span><span class="p">[</span><span class="s">&#39;utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="p">{},</span> <span class="n">goods_vector</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">goods_vector</span><span class="p">[</span><span class="s">&#39;utility&#39;</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Household.set_utility_function"><a class="viewcode-back" href="../Household.html#abceagent.Household.set_utility_function">[docs]</a>    <span class="k">def</span> <span class="nf">set_utility_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a utility function from formula</span>

<span class="sd">        Utility_functions are than used as an argument in consume_with_utility,</span>
<span class="sd">        predict_utility and predict_utility_and_consumption.</span>

<span class="sd">        create_utility_function_fast is faster but more complicatedutility_function</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            utility function. (string) needs to start with &#39;utility = ...&#39;</span>

<span class="sd">        Returns:</span>
<span class="sd">            A utility_function</span>

<span class="sd">        Example:</span>
<span class="sd">            formula = &#39;utility = ball + paint&#39;</span>
<span class="sd">            self._utility_function = self.create_utility_function(formula)</span>
<span class="sd">            self.consume_with_utility(self._utility_function, {&#39;ball&#39; : 1, &#39;paint&#39; : 2})</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">parse_single_input</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="s">&#39;=&#39;</span><span class="p">)</span> \
                <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">OneOrMore</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Suppress</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Optional</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">nums</span> <span class="o">+</span> <span class="s">&#39;*/+-().[]{} &#39;</span><span class="p">)))</span>
                <span class="o">+</span> <span class="n">pp</span><span class="o">.</span><span class="n">Word</span><span class="p">(</span><span class="n">pp</span><span class="o">.</span><span class="n">alphas</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">,</span> <span class="n">pp</span><span class="o">.</span><span class="n">alphanums</span> <span class="o">+</span> <span class="s">&quot;_&quot;</span><span class="p">))</span>
        <span class="n">parse_input</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">delimitedList</span><span class="p">(</span><span class="n">parse_single_input</span><span class="p">,</span> <span class="s">&#39;;&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">parse_input</span><span class="o">.</span><span class="n">parseString</span><span class="p">(</span><span class="n">formula</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Household.set_utility_function_fast"><a class="viewcode-back" href="../Household.html#abceagent.Household.set_utility_function_fast">[docs]</a>    <span class="k">def</span> <span class="nf">set_utility_function_fast</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="s">&#39;from_formula&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a utility function from formula</span>

<span class="sd">        Utility_functions are than used as an argument in consume_with_utility,</span>
<span class="sd">        predict_utility and predict_utility_and_consumption.</span>

<span class="sd">        create_utility_function_fast is faster but more complicated</span>

<span class="sd">        Args:</span>
<span class="sd">            &quot;formula&quot;: equation or set of equations that describe the</span>
<span class="sd">            production process. (string) Several equation are seperated by a ;</span>
<span class="sd">            [output]: list of all output goods (left hand sides of the equations)</span>

<span class="sd">        Returns:</span>
<span class="sd">            A utility_function that can be used in produce etc.</span>

<span class="sd">        Example:</span>
<span class="sd">            formula = &#39;utility = ball + paint&#39;</span>

<span class="sd">            self._utility_function = self.create_utility_function(formula, [&#39;ball&#39;, &#39;paint&#39;])</span>
<span class="sd">            self.consume_with_utility(self._utility_function, {&#39;ball&#39; : 1, &#39;paint&#39; : 2}</span>

<span class="sd">        //exponential is ** not ^</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">typ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">input_goods</span>
</div>
<div class="viewcode-block" id="Household.set_cobb_douglas_utility_function"><a class="viewcode-back" href="../Household.html#abceagent.Household.set_cobb_douglas_utility_function">[docs]</a>    <span class="k">def</span> <span class="nf">set_cobb_douglas_utility_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exponents</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates a Cobb-Douglas utility function</span>

<span class="sd">        Utility_functions are than used as an argument in consume_with_utility,</span>
<span class="sd">        predict_utility and predict_utility_and_consumption.</span>

<span class="sd">        Args:</span>
<span class="sd">            {&#39;input1&#39;: exponent1, &#39;input2&#39;: exponent2 ...}: dictionary</span>
<span class="sd">            containing good names &#39;input&#39; and correstponding exponents</span>
<span class="sd">        Returns:</span>
<span class="sd">            A utility_function that can be used in consume_with_utility etc.</span>

<span class="sd">        Example:</span>
<span class="sd">        self._utility_function = self.create_cobb_douglas({&#39;bread&#39; : 10, &#39;milk&#39; : 1})</span>
<span class="sd">        self.produce(self.plastic_utility_function, {&#39;bread&#39; : 20, &#39;milk&#39; : 1})</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">formula</span> <span class="o">=</span> <span class="s">&#39;utility=&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s">&#39;*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;**&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">input_good</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">input_quantity</span><span class="p">)])</span> <span class="k">for</span> <span class="n">input_good</span><span class="p">,</span> <span class="n">input_quantity</span> <span class="ow">in</span> <span class="n">exponents</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()]))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;cobb-douglas&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;parameters&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exponents</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;formula&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">formula</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compiler</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;exec&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;input&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">exponents</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Household.predict_utility"><a class="viewcode-back" href="../Household.html#abceagent.Household.predict_utility">[docs]</a>    <span class="k">def</span> <span class="nf">predict_utility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Predicts the utility of a vecor of input goods</span>

<span class="sd">            Predicts the utility of consume_with_utility(utility_function, input_goods)</span>

<span class="sd">        Args::</span>

<span class="sd">            {&#39;input_good1&#39;: amount1, &#39;input_good2&#39;: amount2 ...}: dictionary</span>
<span class="sd">            containing the amount of input good used for the production.</span>

<span class="sd">        Returns::</span>

<span class="sd">            utility: Number</span>

<span class="sd">        Example::</span>

<span class="sd">            print(A.predict_utility(self._utility_function, {&#39;ball&#39;: 2, &#39;paint&#39;: 1}))</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">goods_vector</span> <span class="o">=</span> <span class="n">input_goods</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">goods_vector</span><span class="p">[</span><span class="s">&#39;utility&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_utility_function</span><span class="p">[</span><span class="s">&#39;code&#39;</span><span class="p">],</span> <span class="p">{},</span> <span class="n">goods_vector</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">goods_vector</span><span class="p">[</span><span class="s">&#39;utility&#39;</span><span class="p">]</span>

</div></div>
<span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s">&#39;price&#39;</span><span class="p">,</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Sorts the object by the key</span>

<span class="sd">    Args::</span>

<span class="sd">     reverse=True for descending</span>

<span class="sd">    Example::</span>

<span class="sd">        quotes_by_price = sort(quotes, &#39;price&#39;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">objects</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">objects</span><span class="p">:</span> <span class="n">objects</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">reverse</span><span class="o">=</span><span class="n">reverse</span><span class="p">)</span>


<div class="viewcode-block" id="Database"><a class="viewcode-back" href="../Database.html#abceagent.Database">[docs]</a><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot; The database class &quot;&quot;&quot;</span>
<div class="viewcode-block" id="Database.log"><a class="viewcode-back" href="../Database.html#abceagent.Database.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">data_to_log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; With log you can write the models data. Log can save variable states</span>
<span class="sd">        and and the working of individual functions such as production,</span>
<span class="sd">        consumption, give, but not trade(as its handled automatically).</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;name&#39;(string):</span>
<span class="sd">                the name of the current action/method the agent executes</span>
<span class="sd">            data_to_log:</span>
<span class="sd">                a dictianary with data for the database</span>

<span class="sd">        Example::</span>

<span class="sd">            self.log(&#39;profit&#39;, {&#39;&#39;: profit})</span>

<span class="sd">            ... different method ...</span>

<span class="sd">            self.log(&#39;employment_and_rent&#39;, {&#39;employment&#39;: self.possession(&#39;LAB&#39;),</span>
<span class="sd">                                             &#39;rent&#39;: self.possession(&#39;CAP&#39;), &#39;composite&#39;: self.composite})</span>

<span class="sd">            for i in range(self.num_households):</span>
<span class="sd">                self.log(&#39;give%i&#39; % i, self.give(&#39;Household&#39;, i, &#39;money&#39;, payout / self.num_households))</span>

<span class="sd">        See also:</span>
<span class="sd">            :meth:`~abecagent.Database.log_nested`:</span>
<span class="sd">                handles nested dictianaries</span>
<span class="sd">            :meth:`~abecagent.Database.log_change`:</span>
<span class="sd">                loges the change from last round</span>
<span class="sd">            :meth:`~abecagent.Database.observe_begin`:</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_to_write</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">key</span><span class="p">):</span> <span class="n">data_to_log</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_to_log</span><span class="p">}</span>
        <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">data_to_write</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Database.log_value"><a class="viewcode-back" href="../Database.html#abceagent.Database.log_value">[docs]</a>    <span class="k">def</span> <span class="nf">log_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; logs a value, with a name</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;name&#39;(string):</span>
<span class="sd">                the name of the value/variable</span>
<span class="sd">            value(int/float):</span>
<span class="sd">                the variable = value to log</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">({</span><span class="s">&#39;id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">value</span><span class="p">},</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Database.log_dict"><a class="viewcode-back" href="../Database.html#abceagent.Database.log_dict">[docs]</a>    <span class="k">def</span> <span class="nf">log_dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">data_to_log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; same as the log function, only that it supports nested dictionaries</span>
<span class="sd">        see: :meth:`~abecagent.Database.log`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_to_write</span> <span class="o">=</span> <span class="n">flatten</span><span class="p">(</span><span class="n">data_to_log</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_&#39;</span> <span class="o">%</span> <span class="n">action_name</span><span class="p">)</span>
        <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">data_to_write</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="Database.log_change"><a class="viewcode-back" href="../Database.html#abceagent.Database.log_change">[docs]</a>    <span class="k">def</span> <span class="nf">log_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">data_to_log</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This command logs the change in the variable from the round before.</span>
<span class="sd">        Important, use only once with the same action_name.</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;name&#39;(string):</span>
<span class="sd">                the name of the current action/method the agent executes</span>
<span class="sd">            data_to_log:</span>
<span class="sd">                a dictianary with data for the database</span>

<span class="sd">        Examples::</span>

<span class="sd">            self.log_change(&#39;profit&#39;, {&#39;money&#39;: self.possession(&#39;money&#39;)]})</span>
<span class="sd">            self.log_change(&#39;inputs&#39;, {&#39;money&#39;: self.possessions([&#39;money&#39;, &#39;gold&#39;, &#39;CAP&#39;, &#39;LAB&#39;)]})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_to_write</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_to_log</span><span class="p">:</span>
                <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_change_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_to_log</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_log_1</span><span class="p">[</span><span class="n">action_name</span><span class="p">][</span><span class="n">key</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_to_log</span><span class="p">:</span>
                <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_change_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> <span class="n">data_to_log</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">data_to_write</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_log_1</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_to_log</span>
</div>
<div class="viewcode-block" id="Database.observe_begin"><a class="viewcode-back" href="../Database.html#abceagent.Database.observe_begin">[docs]</a>    <span class="k">def</span> <span class="nf">observe_begin</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">data_to_observe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; observe_begin and observe_end, observe the change of a variable.</span>
<span class="sd">        observe_begin(...), takes a list of variables to be observed.</span>
<span class="sd">        observe_end(...) writes the change in this vars into the log file</span>

<span class="sd">        you can use nested observe_begin / observe_end combinations</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;name&#39;(string):</span>
<span class="sd">                the name of the current action/method the agent executes</span>
<span class="sd">            data_to_log:</span>
<span class="sd">                a dictianary with data for the database</span>

<span class="sd">        Example::</span>

<span class="sd">            self.log(&#39;production&#39;, {&#39;composite&#39;: self.composite,</span>
<span class="sd">                                    self.sector: self.final_product[self.sector]})</span>

<span class="sd">            ... different method ...</span>

<span class="sd">            self.log(&#39;employment_and_rent&#39;, {&#39;employment&#39;: self.possession(&#39;LAB&#39;),</span>
<span class="sd">                                            &#39;rent&#39;: self.possession(&#39;CAP&#39;)})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_observe</span><span class="p">[</span><span class="n">action_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_to_observe</span>
</div>
<div class="viewcode-block" id="Database.observe_end"><a class="viewcode-back" href="../Database.html#abceagent.Database.observe_end">[docs]</a>    <span class="k">def</span> <span class="nf">observe_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">action_name</span><span class="p">,</span> <span class="n">data_to_observe</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This command puts in a database called log, what ever values you</span>
<span class="sd">        want values need to be delivered as a dictionary:</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;name&#39;(string):</span>
<span class="sd">                the name of the current action/method the agent executes</span>
<span class="sd">            data_to_log:</span>
<span class="sd">                a dictianary with data for the database</span>

<span class="sd">        Example::</span>

<span class="sd">            self.log(&#39;production&#39;, {&#39;composite&#39;: self.composite,</span>
<span class="sd">                                    self.sector: self.final_product[self.sector]})</span>

<span class="sd">            ... different method ...</span>

<span class="sd">            self.log(&#39;employment_and_rent&#39;, {&#39;employment&#39;: self.possession(&#39;LAB&#39;),</span>
<span class="sd">                                            &#39;rent&#39;:self.possession(&#39;CAP&#39;)})</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">before</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_observe</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">action_name</span><span class="p">)</span>
        <span class="n">data_to_write</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data_to_observe</span><span class="p">:</span>
            <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_delta_</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">action_name</span><span class="p">,</span> <span class="n">key</span><span class="p">)]</span> <span class="o">=</span> \
                                            <span class="n">data_to_observe</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">before</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="n">data_to_write</span><span class="p">[</span><span class="s">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">data_to_write</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>

</div></div>
<span class="k">def</span> <span class="nf">Offer</span><span class="p">(</span><span class="n">sender_group</span><span class="p">,</span> <span class="n">sender_idn</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">,</span> <span class="n">price</span><span class="p">,</span> <span class="n">buysell</span><span class="o">=</span><span class="s">&#39;s&#39;</span><span class="p">,</span> <span class="n">idn</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="n">offer</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender_group</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;sender_idn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sender_idn</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_group&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver_group</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;receiver_idn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">receiver_idn</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;good&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">good</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;quantity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;price&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">price</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;buysell&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">buysell</span>
    <span class="n">offer</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">idn</span>
    <span class="k">return</span> <span class="n">offer</span>


<div class="viewcode-block" id="Agent"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent">[docs]</a><span class="k">class</span> <span class="nc">Agent</span><span class="p">(</span><span class="n">Database</span><span class="p">,</span> <span class="n">Trade</span><span class="p">,</span> <span class="n">Messaging</span><span class="p">,</span> <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Every agent has to inherit this class. It connects the agent to the simulation</span>
<span class="sd">    and to other agent. The :class:`abceagent.Trade`, :class:`abceagent.Database` and</span>
<span class="sd">    :class:`abceagent.Messaging` classes are include. You can enhance an agent, by also</span>
<span class="sd">    inheriting from :class:`abceagent.Firm`.:class:`abceagent.FirmMultiTechnologies`</span>
<span class="sd">    or :class:`abceagent.Household`.</span>

<span class="sd">    For example::</span>

<span class="sd">        class Household(abceagent.Agent, abceagent.Household):</span>
<span class="sd">            def __init__(self, simulation_parameters, agent_parameters, _pass_to_engine):</span>
<span class="sd">            abceagent.Agent.__init__(self, *_pass_to_engine)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">idn</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="n">_addresses</span><span class="p">,</span> <span class="n">trade_logging</span><span class="p">):</span>
        <span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">idn</span> <span class="o">=</span> <span class="n">idn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%i</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">idn</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">group</span> <span class="o">=</span> <span class="n">group</span>
        <span class="c">#TODO should be group_address(group), but it would not work</span>
        <span class="c"># when fired manual + &#39;:&#39; and manual group_address need to be removed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_addresses</span> <span class="o">=</span> <span class="n">_addresses</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_register_actions</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">trade_logging</span> <span class="o">==</span> <span class="s">&#39;individual&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept_agent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept_agent</span>
        <span class="k">elif</span> <span class="n">trade_logging</span> <span class="o">==</span> <span class="s">&#39;group&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept_group</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept_group</span>
        <span class="k">elif</span> <span class="n">trade_logging</span> <span class="o">==</span> <span class="s">&#39;off&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&#39;trade_logging wrongly defined in agent.__init__&#39;</span> <span class="o">+</span> <span class="n">trade_logging</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="c">#TODO make defaultdict; delete all key errors regarding self._haves as defaultdict, does not have missing keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="s">&#39;money&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">=</span> <span class="n">Offer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">buysell</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">idn</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="bp">None</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;accepted&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="bp">None</span><span class="p">][</span><span class="s">&#39;status_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_answered_offers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offer_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_reject_offers_retrieved_end_subround</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_observe</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_data_to_log_1</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="o">=</span> <span class="mi">0</span>

<div class="viewcode-block" id="Agent.possession"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.possession">[docs]</a>    <span class="k">def</span> <span class="nf">possession</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">good</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns how much of good an agent possesses.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A number.</span>

<span class="sd">        possession does not return a dictionary for self.log(...), you can use self.possessions([...])</span>
<span class="sd">        (plural) with self.log.</span>

<span class="sd">        Example:</span>

<span class="sd">            if self.possession(&#39;money&#39;) &lt; 1:</span>
<span class="sd">                self.financial_crisis = True</span>

<span class="sd">            if not(is_positive(self.possession(&#39;money&#39;)):</span>
<span class="sd">                self.bancrupcy = True</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
</div>
<div class="viewcode-block" id="Agent.possessions"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.possessions">[docs]</a>    <span class="k">def</span> <span class="nf">possessions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">list_of_goods</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a dictionary of goods and the correstponding amount an agent owns</span>

<span class="sd">        Argument:</span>
<span class="sd">            A list with good names. Can be a list with a single element.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary, that can be used with self.log(..)</span>

<span class="sd">        Examples::</span>

<span class="sd">            self.log(&#39;buget&#39;, self.possesions([&#39;money&#39;]))</span>

<span class="sd">            self.log(&#39;goods&#39;, self.possesions([&#39;gold&#39;, &#39;wood&#39;, &#39;grass&#39;]))</span>

<span class="sd">            have = self.possessions([&#39;gold&#39;, &#39;wood&#39;, &#39;grass&#39;]))</span>
<span class="sd">            for good in have:</span>
<span class="sd">                if have[good] &gt; 5:</span>
<span class="sd">                    rich = True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">list_of_goods</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">),</span> <span class="s">&quot;possession takes a list of good names (string)&quot;</span>
        <span class="k">return</span> <span class="p">{</span><span class="n">good</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">list_of_goods</span><span class="p">}</span>
</div>
<div class="viewcode-block" id="Agent.possessions_all"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.possessions_all">[docs]</a>    <span class="k">def</span> <span class="nf">possessions_all</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns all possessions &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Agent.possessions_filter"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.possessions_filter">[docs]</a>    <span class="k">def</span> <span class="nf">possessions_filter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">goods</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">but</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">match</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">typ</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a subset of the goods an agent owns:</span>

<span class="sd">        Args:</span>
<span class="sd">            goods (list, optional):</span>
<span class="sd">                a list of goods to return</span>
<span class="sd">            but(list, optional):</span>
<span class="sd">                all goods but the list of goods here</span>
<span class="sd">            match(string, optional TODO):</span>
<span class="sd">                goods that match pattern</span>
<span class="sd">            begin_with(string, optional TODO):</span>
<span class="sd">                all goods that begin with string</span>
<span class="sd">            end_with(string, optional TODO)</span>
<span class="sd">                all goods that end with string</span>
<span class="sd">            is(string, optional TODO)</span>
<span class="sd">                &#39;resources&#39;:</span>
<span class="sd">                    return only goods that are endowments</span>
<span class="sd">                &#39;perishable&#39;:</span>
<span class="sd">                    return only goods that are perishable</span>
<span class="sd">                &#39;resources+perishable&#39;:</span>
<span class="sd">                    goods that are both</span>
<span class="sd">                &#39;produced_by_resources&#39;:</span>
<span class="sd">                    goods which can be produced by resources</span>

<span class="sd">        Example::</span>

<span class="sd">            self.consume(self.possessions_filter(but=[&#39;money&#39;]))</span>
<span class="sd">            # This is redundant if money is not in the utility function</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="n">goods</span><span class="p">):</span>
            <span class="n">goods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">but</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">goods</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">goods</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">but</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&quot;goods and/or but must be a list e.G. [&#39;element1&#39;, &#39;element2&#39;]&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">dict</span><span class="p">((</span><span class="n">good</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span> <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">goods</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_offer_counter</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; returns a uniqe number for an offer (containing the agent&#39;s name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_offer_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_offer_count</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_register_actions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; registers all actions of the Agent, which do not start with &#39;_&#39; &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">ismethod</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="ow">and</span>
                    <span class="ow">not</span><span class="p">(</span><span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">Agent</span><span class="p">)</span> <span class="ow">or</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="nb">vars</span><span class="p">(</span><span class="n">multiprocessing</span><span class="o">.</span><span class="n">Process</span><span class="p">))):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">method</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_advance_round&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_advance_round</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_clearing__end_of_subround&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_clearing__end_of_subround</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_db_panel&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_db_panel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_perish&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_perish</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_produce_resource_rent_and_labor&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_produce_resource_rent_and_labor</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="s">&#39;_aesof&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_aesof</span>
            <span class="c">#TODO inherited classes provide methods that should not be callable</span>
            <span class="c">#change _ policy _ callable from outside __ not and exception lists</span>

    <span class="k">def</span> <span class="nf">_advance_round</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">offer_iterator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_answered_offers</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span>
        <span class="n">recent_answerd_offers</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">offer_id</span><span class="p">,</span> <span class="n">offer</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">offer_iterator</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">offer</span><span class="p">[</span><span class="s">&#39;round&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>  <span class="c"># message from prelast round</span>
                    <span class="n">recent_answerd_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer</span>
                    <span class="k">break</span>
            <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
                <span class="n">offer_id</span><span class="p">,</span> <span class="n">offer</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">offer_iterator</span><span class="p">)</span>
                <span class="n">recent_answerd_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">offer</span>
        <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_answered_offers</span> <span class="o">=</span> <span class="n">recent_answerd_offers</span>

        <span class="n">keep</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span><span class="p">(</span><span class="s">&#39;status&#39;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">]):</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s">&#39;status_round&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">:</span>
                <span class="n">keep</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span> <span class="o">=</span> <span class="n">keep</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;trade_log&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_trade_log</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">round</span> <span class="o">+=</span> <span class="mi">1</span>

<div class="viewcode-block" id="Agent.create"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.create">[docs]</a>    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; creates quantity of the good out of nothing</span>

<span class="sd">        Use this create with care, as long as you use it only for labor and</span>
<span class="sd">        natural resources your model is macroeconomally complete.</span>

<span class="sd">        Args:</span>
<span class="sd">            &#39;good&#39;: is the name of the good</span>
<span class="sd">            quantity: number</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">+=</span> <span class="n">quantity</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="n">quantity</span>
</div>
<div class="viewcode-block" id="Agent.destroy"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.destroy">[docs]</a>    <span class="k">def</span> <span class="nf">destroy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; destroys quantity of the good,</span>

<span class="sd">        Args::</span>

<span class="sd">            &#39;good&#39;: is the name of the good</span>
<span class="sd">            quantity: number</span>

<span class="sd">        Raises::</span>

<span class="sd">            NotEnoughGoods: when goods are insufficient</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">-=</span> <span class="n">quantity</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">raise</span> <span class="n">NotEnoughGoods</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">good</span><span class="p">,</span> <span class="n">quantity</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">])</span>
</div>
<div class="viewcode-block" id="Agent.destroy_all"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.destroy_all">[docs]</a>    <span class="k">def</span> <span class="nf">destroy_all</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">good</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; destroys all of the good, returns how much</span>

<span class="sd">        Args::</span>

<span class="sd">            &#39;good&#39;: is the name of the good</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">quantity_destroyed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">quantity_destroyed</span>
</div>
<div class="viewcode-block" id="Agent.run"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.run">[docs]</a>    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">context</span> <span class="o">=</span> <span class="n">zmq</span><span class="o">.</span><span class="n">Context</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addresses</span><span class="p">[</span><span class="s">&#39;command_addresse&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="s">&quot;all&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">SUBSCRIBE</span><span class="p">,</span> <span class="n">group_address</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PUSH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addresses</span><span class="p">[</span><span class="s">&#39;frontend&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">PUSH</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addresses</span><span class="p">[</span><span class="s">&#39;database&#39;</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">messages_in</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">DEALER</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages_in</span><span class="o">.</span><span class="n">setsockopt</span><span class="p">(</span><span class="n">zmq</span><span class="o">.</span><span class="n">IDENTITY</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">messages_in</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_addresses</span><span class="p">[</span><span class="s">&#39;backend&#39;</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;register_agent&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">])</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">addressee</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">command</span> <span class="o">==</span> <span class="s">&quot;!&quot;</span><span class="p">:</span>
                <span class="n">subcommand</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">subcommand</span> <span class="o">==</span> <span class="s">&#39;die&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">__signal_finished</span><span class="p">()</span>
                    <span class="k">break</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="n">command</span><span class="p">]()</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">command</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">SystemExit</span><span class="p">(</span><span class="s">&#39;The method - &#39;</span> <span class="o">+</span> <span class="n">command</span> <span class="o">+</span> <span class="s">&#39; - called in the agent_list is not declared (&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span>
            <span class="k">if</span> <span class="n">command</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__reject_polled_but_not_accepted_offers</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__signal_finished</span><span class="p">()</span>
        <span class="c">#self.context.destroy()</span>
</div>
    <span class="k">def</span> <span class="nf">_produce_resource_rent_and_labor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">resource</span><span class="p">,</span> <span class="n">units</span><span class="p">,</span> <span class="n">product</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">resource</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">resource</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">product</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">units</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">resource</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">_perish</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">goods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv_multipart</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">good</span> <span class="ow">in</span> <span class="n">goods</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">good</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">good</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s">&#39;good&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">good</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s">&#39;good&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">good</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">given_offers</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;perished&#39;</span>

    <span class="k">def</span> <span class="nf">_db_panel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data_to_track</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_methods</span><span class="p">[</span><span class="n">command</span><span class="p">]()</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">data_to_track</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span>
        <span class="c">#TODO this leads to ambigues errors when there is a KeyError in the data_to_track</span>
        <span class="c">#method (which is common), but testing takes to much time</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&quot;panel&quot;</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">data_to_track</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">idn</span><span class="p">),</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">group</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database_connection</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">round</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__reject_polled_but_not_accepted_offers</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">to_reject</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">offer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;polled&#39;</span><span class="p">:</span>
                <span class="n">to_reject</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">offer_id</span><span class="p">)</span>
            <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">][</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;received&#39;</span><span class="p">:</span>
                <span class="n">good</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">][</span><span class="s">&#39;good&#39;</span><span class="p">]</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&#39;Warning:     </span><span class="si">%s</span><span class="s"> has received offers that have not been polled with &#39;</span>
                <span class="s">&#39;get_offers(...) or get_offers_all() in this round the &#39;</span>
                <span class="s">&#39;offer_id is: &quot;</span><span class="si">%s</span><span class="s">&quot; and the good is &quot;</span><span class="si">%s</span><span class="s">&quot;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">offer_id</span><span class="p">,</span> <span class="n">good</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">offer_id</span> <span class="ow">in</span> <span class="n">to_reject</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">reject</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">offer_id</span><span class="p">])</span>

<div class="viewcode-block" id="Agent.aesof_exec"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.aesof_exec">[docs]</a>    <span class="k">def</span> <span class="nf">aesof_exec</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; executes a command in your excel file. see instruction of pythons exec commmand &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">exec</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aesof</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">aesof</span><span class="p">[</span><span class="n">column_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="Agent.aesof_eval"><a class="viewcode-back" href="../Agent_class.html#abceagent.Agent.aesof_eval">[docs]</a>    <span class="k">def</span> <span class="nf">aesof_eval</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">column_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; evaluates an expression&#39; in your excel file. see instruction of pythons eval commmand &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">eval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aesof</span><span class="p">[</span><span class="n">column_name</span><span class="p">],</span> <span class="nb">globals</span><span class="p">(),</span> <span class="nb">locals</span><span class="p">())</span>
</div>
    <span class="k">def</span> <span class="nf">_aesof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aesof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">commands</span><span class="o">.</span><span class="n">recv_json</span><span class="p">()</span>

    <span class="c">#TODO go to trade</span>
    <span class="k">def</span> <span class="nf">_clearing__end_of_subround</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; agent receives all messages and objects that have been send in this</span>
<span class="sd">        subround and deletes the offers that where retracted, but not executed.</span>

<span class="sd">        &#39;_o&#39;: registers a new offer</span>
<span class="sd">        &#39;_d&#39;: delete received that the issuing agent retract</span>
<span class="sd">        &#39;_a&#39;: clears a made offer that was accepted by the other agent</span>
<span class="sd">        &#39;_p&#39;: counterparty partially accepted a given offer</span>
<span class="sd">        &#39;_r&#39;: deletes an offer that the other agent rejected</span>
<span class="sd">        &#39;_g&#39;: recive a &#39;free&#39; good from another party</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">typ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages_in</span><span class="o">.</span><span class="n">recv</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;.&#39;</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">messages_in</span><span class="o">.</span><span class="n">recv_json</span><span class="p">()</span>
            <span class="k">if</span>   <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_o&#39;</span><span class="p">:</span>
                <span class="n">msg</span><span class="p">[</span><span class="s">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;received&#39;</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="s">&#39;idn&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">msg</span>
                <span class="c">#TODO make self._open_offers a pointer to _msgs[&#39;_o&#39;]</span>
                <span class="c">#TODO make different lists for sell and buy offers</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_d&#39;</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">_open_offers</span><span class="p">[</span><span class="n">msg</span><span class="p">]</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_a&#39;</span><span class="p">:</span>
                <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_accept</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_accept</span><span class="p">(</span><span class="n">offer</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_p&#39;</span><span class="p">:</span>
                <span class="n">offer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_receive_partial_accept</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_log_receive_partial_accept</span><span class="p">(</span><span class="n">offer</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_r&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_receive_reject</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">typ</span> <span class="o">==</span> <span class="s">&#39;_g&#39;</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_haves</span><span class="p">[</span><span class="n">msg</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">msg</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_msgs</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Message</span><span class="p">(</span><span class="n">msg</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">__signal_finished</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; signals modelswarm via communication that the agent has send all</span>
<span class="sd">        messages and finish his action &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">send_multipart</span><span class="p">([</span><span class="s">&#39;!&#39;</span><span class="p">,</span> <span class="s">&#39;.&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">_send</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">receiver_group</span><span class="p">,</span> <span class="n">receiver_idn</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; sends a message to &#39;receiver_group&#39;, who can be an agent, a group or</span>
<span class="sd">        &#39;all&#39;. The agents receives it at the begin of each round in</span>
<span class="sd">        self.messages(typ) is &#39;m&#39; for mails.</span>
<span class="sd">        typ =(_o,c,u,r) are</span>
<span class="sd">        reserved for internally processed offers.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">_</span><span class="si">%i</span><span class="s">:&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">receiver_group</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s">&#39;ascii&#39;</span><span class="p">),</span> <span class="n">receiver_idn</span><span class="p">),</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">typ</span><span class="p">,</span> <span class="n">zmq</span><span class="o">.</span><span class="n">SNDMORE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">send_json</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">flatten</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">parent_key</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">):</span>
    <span class="n">items</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">flatten</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="s">&#39;</span><span class="si">%s%s</span><span class="s">_&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">k</span><span class="p">))</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">items</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="s">&#39;</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">parent_key</span><span class="p">,</span> <span class="n">k</span><span class="p">),</span> <span class="n">v</span><span class="p">))</span>
    <span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">items</span><span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">ABCE 0.2alpha documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2012, Davoud Taghawi-Nejad.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>